<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>製作資料</title>
</head>

<!-- CSS custom -->
<link rel="stylesheet" href="search.css" />
<link rel="stylesheet" href="style.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"
    integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog=="
    crossorigin="anonymous" />
<!-- JavaScript Bundle with Popper 5.2.2 -->
<!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.min.js" integrity="sha384-IDwe1+LCz02ROU9k972gdyvl+AESN10+x7tBKgc9I5HFtuNz0wWnPclzo6p9vxnk" crossorigin="anonymous"></script> -->

<!-- Bootstrap 4.0.0 -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
    integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous" />
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
    integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>

<!-- Jquery & Jquery csv -->
<script src="https://code.jquery.com/jquery-3.6.1.js" integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI="
    crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/1.0.21/jquery.csv.js"></script>

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.1/dist/bootstrap-table.min.css" />
<!-- Latest compiled and minified JavaScript -->
<script src="https://unpkg.com/bootstrap-table@1.21.1/dist/bootstrap-table.min.js"></script>
<!-- Latest compiled and minified Locales -->
<script src="https://unpkg.com/bootstrap-table@1.21.1/dist/locale/bootstrap-table-zh-CN.min.js"></script>

<!-- Bootstrap Table -->
<!-- <script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script> -->
<style>
    #title-container table {
        margin-top: 3em;
    }


    .style {
        width: 700px;
    }

    a:link {
        text-decoration: none;
    }

    a:visited {
        text-decoration: none;
    }

    a:hover {
        text-decoration: underline;
    }

    a:active {
        text-decoration: underline;
    }
</style>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <a class="navbar-brand" href="#">魔力寶貝超強官網</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown"
            aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavDropdown">
            <ul class="navbar-nav">
                <li class="nav-item active">
                    <!-- 還沒做完 -->
                    <span><a class="nav-link" href="index.html">首頁</a></span>
                </li>
                <li class="nav-item">
                    <!-- 做完 -->
                    <a class="nav-link" href="collect_data.html">採集資料</a>

                </li>

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" data-toggle="dropdown"
                        aria-haspopup="true" aria-expanded="false">
                        製作資料
                    </a>
                    <!-- .dropdown-menu 下拉選單內容 -->
                    <div style="padding: 0; margin:0;" class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <h6 class="dropdown-title"><b>重型武器-橫掃競技場</b></h6>
                        <a class="dropdown-item" href="production_information.html?type=劍">劍</a>
                        <a class="dropdown-item" href="production_information.html?type=斧">斧</a>
                        <a class="dropdown-item" href="production_information.html?type=槍">槍</a>
                        <a class="dropdown-item" href="production_information.html?type=弓">弓</a>
                        <h6 class="dropdown-title"><b>輕型武器-打爆冰樹</b></h6>
                        <a class="dropdown-item" href="#">小刀</a>
                        <a class="dropdown-item" href="#">杖</a>
                        <a class="dropdown-item" href="#">迴力</a>
                        <h6 class="dropdown-title"><b>重型防具-讓三龍害怕</b></h6>
                        <a class="dropdown-item" href="#">盔</a>
                        <a class="dropdown-item" href="#">鎧甲</a>
                        <a class="dropdown-item" href="#">靴子</a>
                        <a class="dropdown-item" href="#">盾</a>
                        <h6 class="dropdown-title"><b>輕型防具-真的輕</b></h6>
                        <a class="dropdown-item" href="#">帽子</a>
                        <a class="dropdown-item" href="#">衣服</a>
                        <a class="dropdown-item" href="#">鞋子</a>
                        <a class="dropdown-item" href="#">袍</a>
                        <h6 class="dropdown-title"><b>仙丹妙藥</b></h6>
                        <a class="dropdown-item" href="#">料理</a>
                        <a class="dropdown-item" href="#">藥水</a>
                    </div>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" data-toggle="dropdown"
                        aria-haspopup="true" aria-expanded="false">
                        技能資料
                    </a>
                    <!-- .dropdown-menu 下拉選單內容 -->
                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <a class="dropdown-item" href="#">人物技能</a>
                        <a class="dropdown-item" href="#">人物技能(New)</a>
                        <a class="dropdown-item" href="#">寵物技能</a>
                        <a class="dropdown-item" href="#">技能屋進入証</a>
                        <a class="dropdown-item" href="#">寵物技能屋</a>
                        <a class="dropdown-item" href="#">耗魔變化道具</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="pet_information.html">寵物資料</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="role_related.html">角色相關</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="pet_equipment.html">寵物裝備資料</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="prop_library.html">初心道具</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="game_task.html">遊戲任務</a>

                </li>
                <li class="nav-item">
                    <a class="nav-link" href="gashapon_library.html">扭蛋資料</a>
                </li>

            </ul>
        </div>
    </nav>

    <!-- 首頁 -->
    <main>
        <div id="title-container" class="d-flex flex-row align-content-start flex-wrap">
            <h2 id="title" class="col-5">製作資料</h2>
            <div class="d-flex flex-row align-content-start flex-wrap">
                <div class="p-2">
                    <label class="btn btn-outline-dark" for="btn-check-outlined1"><a
                            href="production_information.html?type=劍">劍</a></label><br />
                </div>
                <div class="p-2">
                    <label class="btn btn-outline-dark" for="btn-check-outlined1"><a
                            href="production_information.html?type=斧">斧</a></label><br />
                </div>
                <div class="p-2">
                    <label class="btn btn-outline-dark" for="btn-check-outlined1"><a
                            href="production_information.html?type=槍">槍</a></label><br />
                </div>
                <div class="p-2">
                    <label class="btn btn-outline-dark" for="btn-check-outlined1"><a
                            href="production_information.html?type=弓">弓</a></label><br />
                </div>
                <div class="p-2">
                    <label class="btn btn-outline-dark" for="btn-check-outlined1"><a
                            href="production_information.html?type=小刀">小刀</a></label><br />
                </div>
                <div class="p-2">
                    <label class="btn btn-outline-dark" for="btn-check-outlined1"><a
                            href="production_information.html?type=杖">杖</a></label><br />
                </div>
                <div class="p-2">
                    <label class="btn btn-outline-dark" for="btn-check-outlined1"><a
                            href="production_information.html?type=迴力鏢">迴力鏢</a></label><br />
                </div>
                <div class="p-2">
                    <label class="btn btn-outline-dark" for="btn-check-outlined1"><a
                            href="production_information.html?type=頭盔">頭盔</a></label><br />
                </div>
                <div class="p-2">
                    <label class="btn btn-outline-dark" for="btn-check-outlined1"><a
                            href="production_information.html?type=鎧甲">鎧甲</a></label><br />
                </div>
                <div class="p-2">
                    <label class="btn btn-outline-dark" for="btn-check-outlined1"><a
                            href="production_information.html?type=斧"></a></label><br />
                </div>
                <div class="p-2">
                    <label class="btn btn-outline-dark" for="btn-check-outlined1"><a
                            href="production_information.html?type=槍"></a></label><br />
                </div>
                <div class="p-2">
                    <label class="btn btn-outline-dark" for="btn-check-outlined1"><a
                            href="production_information.html?type=弓"></a></label><br />
                </div>
                <div class="p-2">
                    <label class="btn btn-outline-dark" for="btn-check-outlined1"><a
                            href="production_information.html?type=小刀"></a></label><br />
                </div>
                <div class="p-2">
                    <label class="btn btn-outline-dark" for="btn-check-outlined1"><a
                            href="production_information.html?type=杖"></a></label><br />
                </div>
                <div class="p-2">
                    <label class="btn btn-outline-dark" for="btn-check-outlined1"><a
                            href="production_information.html?type=迴力鏢"></a></label><br />
                </div>
                <div class="p-2">
                    <label class="btn btn-outline-dark" for="btn-check-outlined1"><a
                            href="production_information.html?type=弓"></a></label><br />
                <!-- TODO:其他武器還沒有加上去 -->
            </div>
        </div>

        <!-- 劍該出現的東西 -->

        <!-- 斧該出現的東西 -->

    </main>
</body>
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"
    integrity="sha256-xLD7nhI62fcsEZK2/v8LsBcb4lG7dgULkuXoXB/j91c=" crossorigin="anonymous"></script>
<script>

    // 編碼 & 解碼
    // const encodedStr = encodeURI('這是中文字串'); // encodedStr 得到 %E9%80%99%E6%98%AF%E4%B8%AD%E6%96%87%E5%AD%97%E4%B8%B2
    // const decodedStr = decodeURI(encodedStr); // decodedStr 得到 這是中文字串

    // 假設 "?q=1234&txt=abc"
    // q是變數 txt也是變數
    // let urlParams = new URLSearchParams(window.location.search);
    // console.log(urlParams.has('q')); // true
    // console.log(urlParams.get('txt')); // "abc"
    // console.log(urlParams.getAll('action')); // ["abc"]
    // console.log(urlParams.toString()); // "q=1234&txt=abc"
    // console.log(urlParams.append('page', '1')); // "q=1234&txt=abc&page=1"




    // javascript -> Jquery 

    $(document).ready(function () {

        let url = new URLSearchParams(window.location.search);
        let type = url.get('type')

        $('#title').text('製作資料 - ' + type)
        let folder = "production_information_items/";

        // 非同步先執行fetch data 再使用caculate function 
        (async () => {
            var success = await typeSelect();
            itemCaculate()
        })();

        function typeSelect() {
            // TODO:未來要加上去的武器資訊都放在這邊新增
            let types = [
                {
                    type : "劍",
                    fileName : "sword.txt"
                },
                {
                    type : "斧",
                    fileName : "ax.txt"
                },
                {
                    type : "槍",
                    fileName : "spear.txt"
                },
                {
                    type : "弓",
                    fileName : "bow.txt"
                },
                {
                    type : "小刀",
                    fileName : "knife.txt"
                },
            ];
            let findObject = types.find(object => object.type == type);
                  
            return new Promise((resolve, reject) => {
                $.ajax({
                    url: folder + findObject.fileName,
                    dataType: "text",
                    success: function (data) {
                        let html = data;
                        $('#title-container').append(html);
                        resolve(true);
                    }
                });
            })
            
        }
        

        // 物品的計算公式
        async function itemCaculate() {
            $('a[title]').tooltip({ placement: 'top' });
            $('img[title]').tooltip({ placement: 'bottom' });
            $('[data-scroll]').click(function (e) {
                var target = $('#' + $(this).data('scroll'));
                if (!target.length) return;
                target.addClass('sub');
                setTimeout(function () {
                    target.removeClass('sub');
                }, 5000);
                $('body').animate({ scrollTop: target.offset().top - $(window).height() * 0.2 }, 500);
            });
            var imgs = $('img[data-src]');
            var igbase = $('meta[name=igbase]').attr('content');
            for (var i = 0, l = imgs.length; i < l; i++) {
                var im = imgs.eq(i), src = im.data('src'); im.removeAttr('data-src');
                im.attr('src', '//' + igbase + '/g/' + src.substr(0, 2) + '/' + src + '.png');
            };
            var imgspan = $('span[data-src]');
            for (var i = 0, l = imgspan.length; i < l; i++) {
                var im = imgspan.eq(i), src = im.data('src'); im.removeAttr('data-src');
                im.css('background-image', 'url(//' + igbase + '/g/' + src.substr(0, 2) + '/' + src + '.png)');
            };

            $('table>tbody[id]').each(function () {
                tbody = $(this);
                var ip = tbody.find('input[type=number]');
                var dataSet = tbody.find('[data-set]');
                var result = tbody.find('span.slot-result');
                var origin = dataSet.map(function () {
                    var el = $(this), set = Math.max(el.data('set') | 0, 1), unit = Math.max(el.text() | 0, 1);
                    return { set: set, unit: unit, el: el };
                });
                ip.on('input', function (e, init) {
                    var count = $(this).val() | 0, init = init || false, slot = 0;
                    if (count <= 0) return;
                    origin.each(function (i, set) {
                        var t = set.unit * count, m = t % set.set, s = t / set.set | 0;
                        slot += Math.ceil(t / set.set);
                        if (!init) {
                            var p = [];
                            if (s >= 1) {
                                p.push(s + ' 組');
                                if (m >= 1) {
                                    if (p.length) p.push(' +');
                                    p.push(' ' + m);
                                }
                                p.push(' = ' + t);
                            } else p.push(t);
                            set.el.text(p.join(''));
                        }
                    });
                    result.text(slot);
                }).trigger('input', [true]);
            });
        }


    })



</script>

</html>